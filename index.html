<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flipbook RTL</title>

  <style>
    :root{ --pageSize: 600px; }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:#f2f2f2;
      font-family: Arial, sans-serif;
    }

    #stage{
      width: calc(var(--pageSize) * 2);
      height: var(--pageSize);
      position: relative;
      overflow:hidden;
    }

    #mirror{
      width:100%;
      height:100%;
      transform: scaleX(-1); /* يعكس الكتاب ليبدأ من اليمين */
      transform-origin:center;
    }

    #book{ width:100%; height:100%; }

    .page{
      width: var(--pageSize);
      height: var(--pageSize);
      background:#fff;
      overflow:hidden;
    }

    .page img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      background:#fff;

      /* يلغي انعكاس الصورة حتى تبقى طبيعية */
      transform: scaleX(-1);
      transform-origin:center;
    }

    #errorBox{
      position: fixed;
      bottom: 12px;
      left: 12px;
      right: 12px;
      background: #fff3cd;
      border: 1px solid #ffeeba;
      color: #664d03;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 14px;
      display:none;
      direction: rtl;
    }
  </style>
</head>

<body>
  <div id="stage">
    <div id="mirror">
      <div id="book"></div>
    </div>
  </div>

  <div id="errorBox"></div>

  <script>
    // ذكي: يجرّب المسار في root ثم pages/
    const CANDIDATES = [
      { base: "", jq: "jquery.min.js", turn: "turn.min.js", imgBase: "" },
      { base: "pages/", jq: "pages/jquery.min.js", turn: "pages/turn.min.js", imgBase: "pages/" }
    ];

    function showError(msg){
      const box = document.getElementById('errorBox');
      box.style.display = 'block';
      box.textContent = msg;
    }

    function loadScript(src){
      return new Promise((resolve, reject) => {
        const s = document.createElement('script');
        s.src = src;
        s.onload = resolve;
        s.onerror = () => reject(new Error("Failed: " + src));
        document.head.appendChild(s);
      });
    }

    function addPages(imgBase){
      const book = document.getElementById('book');
      book.innerHTML = "";

      // 25 صفحة: page01.jpg..page25.jpg
      for(let i=1; i<=25; i++){
        const num = String(i).padStart(2,'0');
        const div = document.createElement('div');
        div.className = "page";
        const img = document.createElement('img');
        img.src = `${imgBase}page${num}.jpg`;
        img.alt = `page${num}`;
        div.appendChild(img);
        book.appendChild(div);
      }
    }

    async function init(){
      for(const c of CANDIDATES){
        try{
          await loadScript(c.jq);
          await loadScript(c.turn);

          addPages(c.imgBase);

          if(!window.jQuery || !jQuery.fn.turn){
            throw new Error("Turn.js not available");
          }

          jQuery('#book').turn({
            width: 1200,
            height: 600,
            autoCenter: true,
            display: 'double'
          });

          jQuery('#book').turn('page', 1);
          return; // نجاح
        }catch(e){
          // جرّبي المرشح التالي
        }
      }

      showError("المشكلة: ملفات jquery.min.js أو turn.min.js غير موجودة في المسار الصحيح (root أو pages). افتحي رابط …/turn.min.js وتحققي أنه لا يعطي 404.");
    }

    init();
  </script>
</body>
</html>
